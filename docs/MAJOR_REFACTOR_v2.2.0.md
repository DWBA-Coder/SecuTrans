# SecuTrans v2.2.0 重大重构记录

## 🎯 重构目标
完成用户提出的重大界面重构需求，将发送和接收功能整合到统一界面中，实现同时进行收发操作。

## 📁 项目结构重新组织

### 目录结构调整
```
SecuTrans/
├── main.py                    # 主程序入口
├── README.md                  # 项目说明（保留在根目录）
├── requirements.txt           # 依赖文件
├── src/                     # 源代码目录
│   ├── core/                # 核心功能模块
│   ├── gui/                 # 界面模块
│   └── utils/               # 工具模块
├── keys/                    # 密钥文件存储
├── certificates/             # 证书文件存储
├── files/                   # 接收文件存储
├── logs/                    # 日志文件存储
├── config/                  # 配置文件存储
└── docs/                    # 文档目录
    ├── CHANGELOG.md          # 更新日志
    ├── PROJECT_SUMMARY.md    # 项目总结
    └── *.md               # 其他文档
```

### 文件分类
- **密钥文件**: `keys/` 目录（私钥文件）
- **证书文件**: `certificates/` 目录（公钥证书）
- **接收文件**: `files/` 目录（接收的文件）
- **日志文件**: `logs/` 目录（操作日志）
- **配置文件**: `config/` 目录（应用配置）
- **文档文件**: `docs/` 目录（所有文档）

## 🖥️ 界面全面重构

### 统一界面设计
- **发送接收合并**: 单一界面支持同时收发操作
- **四层布局**: 上、中上、中下、下四个功能区域
- **标准按钮**: 使用系统默认按钮，简化代码

### 功能区域布局

#### 上层：密钥管理
**左半部分 - 密钥生成**:
- 密钥信息输入：姓名、邮箱、组织
- 生成密钥对按钮
- 自定义位置按钮（预留功能）
- 自动导入生成的私钥

**右半部分 - 密钥选择**:
- 我的私钥：导入和显示私钥文件名
- 接收方证书：导入和显示证书文件名

#### 中上层：文件管理
**上半部分 - 文件选择**:
- 文件浏览：选择发送文件
- 文件信息：显示文件名、类型、大小、修改时间、路径

**下半部分 - 文件保存**:
- 保存路径：设置接收文件的保存目录
- 路径浏览：自定义保存位置

#### 中下层：文件传输
**左半部分 - 文件发送**:
- 加密设置：算法选择、模式选择、安全状态显示
- 网络设置：接收方IP、端口
- 连接发送按钮
- 发送进度条

**右半部分 - 文件接收**:
- 服务器设置：监听端口、本地IP显示
- 服务器控制：启动/停止按钮
- 连接状态：服务器状态、客户端信息
- 接收进度条

#### 下层：日志记录
- 日志显示：多颜色日志（普通黑色、成功绿色、警告黄色、错误红色）
- 日志控制：清空日志、保存日志按钮

## 🔧 核心功能增强

### 1. 配置管理系统
**新增模块**: `src/core/app_config.py`

**功能特性**:
- **自动保存**: 所有配置自动保存到JSON文件
- **智能加载**: 启动时自动加载上次配置
- **配置项**: 密钥路径、保存目录、端口、加密设置等

**配置文件**: `config/app_config.json`

### 2. 密钥管理优化
**密钥生成规则**:
```
格式: {姓名}_{时间戳}_private.pem / {姓名}_{时间戳}_public.pem
示例: SecuTrans_20251227_140515_private.pem
```

**自动导入**:
- 生成的私钥自动导入到界面
- 密钥信息自动保存配置

### 3. 端口标准化
**新端口**: 5375
- **含义**: SeuTrans缩写 → SeTs → 5375（手机键盘映射）
- **默认配置**: 所有网络操作默认使用5375端口

### 4. 进度条系统
**发送进度条**:
- 实时显示发送进度
- 百分比显示
- 自动重置

**接收进度条**:
- 实时显示接收进度
- 解密进度指示
- 完成后自动重置

### 5. 增强的菜单系统
**文件菜单**:
- Ctrl+O: 选择发送文件
- Ctrl+G: 生成密钥对
- Ctrl+I: 导入私钥
- Ctrl+C: 导入证书

**工具菜单**:
- F2: 启动服务器
- F3: 停止服务器
- Ctrl+E: 导出配置（预留）
- Ctrl+P: 导入配置（预留）

**帮助菜单**:
- F1: 使用说明
- Ctrl+A: 关于信息

### 6. 多颜色日志系统
**颜色编码**:
- **INFO (黑色)**: 普通操作日志
- **SUCCESS (绿色)**: 成功操作日志
- **WARNING (黄色/橙色)**: 警告信息
- **ERROR (红色)**: 错误和失败信息

## 🎨 用户体验提升

### 1. 界面统一性
- **按钮风格**: 使用系统默认按钮，保持原生风格
- **布局合理**: 功能分区清晰，操作流程顺畅
- **状态反馈**: 实时显示操作状态和进度

### 2. 操作便利性
- **一键生成**: 密钥生成后自动导入
- **配置持久**: 关闭重启保持设置
- **快捷操作**: 常用功能都有快捷键

### 3. 信息完整性
- **文件详情**: 完整显示文件信息
- **安全提示**: 实时显示算法和模式安全性
- **状态监控**: 详细的连接和传输状态

## 🔄 代码重构

### 模块化改进
**新增模块**:
- `src/core/app_config.py`: 配置管理
- `src/gui/unified_interface.py`: 统一界面实现

**重构内容**:
- 删除旧的分窗口界面
- 合并发送接收逻辑
- 简化按钮组件，使用系统默认

### 配置系统架构
```python
class AppConfig:
    def load_config(self)          # 加载配置
    def save_config(self)          # 保存配置
    def get(self, key, default)   # 获取配置项
    def set(self, key, value)     # 设置配置项
```

### 界面组件重用
- **进度条组件**: 统一的进度条实现
- **日志组件**: 多颜色日志显示
- **配置绑定**: 自动保存和加载配置

## 📊 性能优化

### 1. 内存管理
- **日志限制**: 限制日志行数，避免内存溢出
- **进度重置**: 操作完成后自动释放进度条资源

### 2. 网络优化
- **线程管理**: 收发操作使用独立线程
- **状态同步**: 主线程和子线程状态同步

### 3. 文件管理
- **目录创建**: 自动创建必要的目录结构
- **路径标准化**: 统一的文件路径处理

## 🛡️ 安全性增强

### 1. 配置安全
- **敏感信息**: 私钥路径等敏感信息妥善保存
- **权限控制**: 配置文件读写权限控制

### 2. 操作安全
- **状态验证**: 发送前验证文件和证书
- **错误处理**: 完善的异常处理机制

## 📋 兼容性说明

### 配置兼容
- **向后兼容**: 支持导入旧版本配置
- **数据迁移**: 自动迁移旧密钥文件到新目录

### 文件兼容
- **密钥格式**: 保持与旧版本兼容的PEM格式
- **传输协议**: 保持数字信封格式不变

## 🚀 部署说明

### 环境要求
- **Python 3.7+**
- **pycryptodome >= 3.19.0**
- **tkinter** (通常随Python安装)

### 目录要求
- **keys/**: 密钥文件目录（自动创建）
- **certificates/**: 证书文件目录（自动创建）
- **files/**: 接收文件目录（自动创建）
- **logs/**: 日志文件目录（自动创建）
- **config/**: 配置文件目录（自动创建）

## 🎯 版本特性总结

### v2.2.0 重大更新
1. ✅ **项目结构重组**: 目录分类清晰，文件管理规范
2. ✅ **统一界面设计**: 收发功能合并，操作更便捷
3. ✅ **配置管理系统**: 自动保存配置，用户体验提升
4. ✅ **多颜色日志**: 信息分级显示，状态更清晰
5. ✅ **进度条系统**: 实时进度反馈，操作可视化
6. ✅ **端口标准化**: 5375端口，符合SeuTrans标识
7. ✅ **菜单功能增强**: 快捷键完整，功能覆盖全面

---

**重构版本**: v2.2.0  
**重构日期**: 2025-12-27  
**重构类型**: 重大界面重构 + 功能整合  
**兼容性**: 向后兼容v2.1.x配置和密钥格式